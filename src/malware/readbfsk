#!/bin/bash

# specify error behavior
#set -o errexit
#set -o pipefail
#set -o nounset

# suggested 20k, 60k, 50 respectively
small_bs="$1"
large_bs="$2"
read_count="$3"

# get data from pipe
data="$(cat | xxd -b | cut -d: -f 2 | sed 's/  .*//; s/ //g' | tr -d [:space:])"

# drop cache
echo 3 | sudo tee /proc/sys/vm/drop_caches

# read thru data 
for i in $(seq 1 ${#data})
do
    if [ ${data:i-1:1} = "1" ]; then
        #echo one
        sudo dd if=/dev/sda2 iflag=direct bs="$large_bs" count="$read_count" >& /dev/null
    else
        #echo zero
        sudo dd if=/dev/sda2 iflag=direct bs="$small_bs" count="$read_count" >& /dev/null
    fi
done
