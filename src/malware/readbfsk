#!/bin/bash

# specify error behavior
#set -o errexit
#set -o pipefail
#set -o nounset

# suggested 20k, 35, 60k, 25 respectively
small_bs="$1"
small_count="$2"
large_bs="$3"
large_count="$4"

# get data from pipe
data="$(cat | xxd -b | cut -d: -f 2 | sed 's/  .*//; s/ //g' | tr -d [:space:])"

# drop cache
echo 3 | sudo tee /proc/sys/vm/drop_caches

# create initial string
cmd_str=""

# read thru data 
for i in $(seq 1 ${#data})
do
    if [ ${data:i-1:1} -eq 1 ]; then
        #echo one
        #cmd_str+="dd if=/dev/sda2 iflag=direct bs=\"$large_bs\" count=\"$read_count\" >& /dev/null;"
        dd if=large_file.txt iflag=direct conv=sync bs="$large_bs" count="$large_count" >& /dev/null
    else
        #echo zero
        cmd_str+="dd if=/dev/sda2 iflag=direct bs="$small_bs" count=\"$read_count\" >& /dev/null;"
        dd if=large_file.txt iflag=direct conv=sync bs="$small_bs" count="$small_count" >& /dev/null
    fi
done

#echo "going to eval cmd_str..."
#echo "$cmd_str"
#eval "$cmd_str"
