#!/usr/bin/env bash

# Specify error behavior
set -o errexit
set -o pipefail
set -o nounset

# The below 2 commands are commented out, since we don't have a testbed; also,
# they require admin privileges :( so wouldn't work in attack from userspace

# Turn off the HDD write-back cache mechanism
#sudo hdparm -W0 /dev/sda

# Free pagecache, dentries, and inodes
#echo 3 | sudo tee /proc/sys/vm/drop_caches

# Read from either the arguments, or pipe
if [ -t 0 ]
then
    data=$1
else
    data=$(cat)
fi

# Pipe output to the malware
echo -e "$data" | ./malware
